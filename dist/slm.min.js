!function t(e,i,n){function s(h,o){if(!i[h]){if(!e[h]){var l="function"==typeof require&&require;if(!o&&l)return l(h,!0);if(r)return r(h,!0);throw new Error("Cannot find module '"+h+"'")}var a=i[h]={exports:{}};e[h][0].call(a.exports,function(t){var i=e[h][1][t];return s(i?i:t)},a,a.exports,t,e,i,n)}return i[h].exports}for(var r="function"==typeof require&&require,h=0;h<n.length;h++)s(n[h]);return s}({1:[function(require,module,exports){function Node(){this.method=null,this.children={}}function Dispatcher(){this.methodSplitRE=/_/,this.methodRE=/^on(_[a-zA-Z0-9]+)*$/}Node.prototype.compile=function(t,e){this.method&&(e="this."+this.method+"(exps)");var i="switch(exps["+t+"]) {",n=!0;for(var s in this.children)n=!1,i+="\ncase '"+s+"':\n",i+=this.children[s].compile(t+1,e)+";";return n?"return "+e:i+="\ndefault:\nreturn "+(e||"exps")+";}"};var DispatcherProto=Dispatcher.prototype;DispatcherProto.exec=function(t){return this.compile(t)},DispatcherProto.compile=function(t){return this.dispatcher(t)},DispatcherProto.dispatcher=function(t){return this.replaceDispatcher(t)},DispatcherProto.dispatchedMethods=function(){var t=[];for(var e in this)this.methodRE.test(e)&&t.push(e);return t},DispatcherProto.replaceDispatcher=function(exp){for(var tree=new Node,dispatchedMethods=this.dispatchedMethods(),i=0,method;method=dispatchedMethods[i];i++){for(var types=method.split(this.methodSplitRE),node=tree,j=1,type;type=types[j];j++){var n=node.children[type];node=node.children[type]=n||new Node}node.method=method}var code="[function(exps) {"+tree.compile(0)+"}]";return this.dispatcher=eval(code)[0],this.dispatcher(exp)},module.exports=Dispatcher},{}],2:[function(t,e){function i(){this.chain=[]}var n=i.prototype;n.use=function(t){this.chain.push(t)},n.exec=function(t,e){for(var i,n=t,s=0;i=this.chain[s];s++)n=i.exec(n,e);return n},e.exports=i},{}],3:[function(require,module,exports){function Template(){this.engine=new Engine,this.engine.use(new Parser),this.engine.use(new Interpolation),this.engine.use(new Brackets),this.engine.use(new Controls),this.engine.use(new AttrMerge),this.engine.use(new CodeAttributes),this.engine.use(new AttrRemove),this.engine.use(new FastHtml),this.engine.use(new Escape),this.engine.use(new ControlFlow),this.engine.use(new MultiFlattener),this.engine.use(new StaticMerger),this.engine.use(new StringGenerator)}var Engine=require("./engine"),Parser=require("./parser"),Interpolation=require("./filters/interpolation"),Brackets=require("./filters/brackets"),Controls=require("./filters/controls"),AttrMerge=require("./filters/attr_merge"),CodeAttributes=require("./filters/code_attributes"),AttrRemove=require("./filters/attr_remove"),FastHtml=require("./html/fast"),Escape=require("./filters/escape"),ControlFlow=require("./filters/control_flow"),MultiFlattener=require("./filters/multi_flattener"),StaticMerger=require("./filters/static_merger"),StringGenerator=require("./generators/string_generator");Template.prototype.render=function(t,e){return'function(context) {\nvar slm = require("./runtime");'+this.engine.exec(t,e)+"}"},Template.prototype.eval=function(t,e,i){return this.exec(t,i).call(e)},Template.prototype.exec=function(src,options){var code=this.render(src,options);return eval("["+code+"]")[0]},module.exports=Template},{"./engine":2,"./filters/attr_merge":5,"./filters/attr_remove":6,"./filters/brackets":7,"./filters/code_attributes":8,"./filters/control_flow":9,"./filters/controls":10,"./filters/escape":11,"./filters/interpolation":12,"./filters/multi_flattener":13,"./filters/static_merger":15,"./generators/string_generator":17,"./html/fast":18,"./parser":20}],4:[function(t,e){function i(){}var n=t("./dispatcher"),s=i.prototype=new n,r=0;s.isEmptyExp=function(t){switch(t[0]){case"multi":for(var e=1,i=t.length;i>e;e++)if(!this.isEmptyExp(t[e]))return!1;return!0;case"newline":return!0;default:return!1}},s.uniqueName=function(){return r++,"$lm"+r.toString(16)},s.on_multi=function(t){for(var e=1,i=t.length;i>e;e++)t[e]=this.compile(t[e]);return t},s.on_capture=function(t){return["capture",t[1],t[2],this.compile(t[3])]},s.on_if=function(t){for(var e=2,i=t.length;i>e;e++)t[e]=this.compile(t[e]);return t},s.on_switch=function(t){for(var e=2,i=t.length;i>e;e++){var n=t[e];t[e]=[n[0],this.compile(n[1])]}return t},s.on_block=function(t){return["block",t[1],this.compile(t[2])]},s.on_escape=function(t){return["escape",t[1],this.compile(t[2])]},e.exports=i},{"./dispatcher":1}],5:[function(t,e){function i(){this.mergeAttrs={id:"_","class":" "}}var n=t("./slm");i.prototype=new n,i.prototype.on_html_attrs=function(t){for(var e=[],i={},n=2,s=t.length;s>n;n++){var r=t[n],h=r[2].toString(),o=r[3];if(i[h]){if(!this.mergeAttrs[h])throw new Error("Multiple "+h+" attributes specified");i[h].push(o)}else i[h]=[o],e.push(h)}e.sort();for(var h,l=[],n=0;h=e[n];n++){var a,o=i[h];if((a=this.mergeAttrs[h])&&o.length>1){for(var c,u=["multi"],p=!1,m=0;(c=o[m])&&(p=this.isContainNonEmptyStatic(c),p);m++);if(p){for(var c,m=0;c=o[m];m++)0!==m&&u.push(["static",a]),u.push(c);l[n]=["html","attr",h,u]}else{var f=this.uniqueName();u.push(["code","var "+f+"=[];"]);for(var c,m=0;c=o[m];m++)u.push(["capture",f+"["+m+"]",f+"["+m+"]='';",c]);u.push(["dynamic","slm.rejectEmpty("+f+').join("'+a+'")']),l[n]=["html","attr",h,u]}}else l[n]=["html","attr",h,o[0]]}return["html","attrs"].concat(l)},e.exports=i},{"./slm":14}],6:[function(t,e){function i(){this.removeEmptyAttrs=["id","class"]}var n=t("./slm");i.prototype=new n,i.prototype.on_html_attr=function(t){var e=t[2],i=t[3];if(-1===this.removeEmptyAttrs.indexOf(e.toString()))return n.prototype.on_html_attr.call(this,t);if(this.isEmptyExp(i))return i;if(this.isContainNonEmptyStatic(i))return["html","attr",e,i];var s=this.uniqueName();return["multi",["capture",s,"var "+s+"='';",this.compile(i)],["if",s+".length",["html","attr",e,["dynamic",s]]]]},e.exports=i},{"./slm":14}],7:[function(t,e){function i(){this.blockRe=/^(case|default)\b/,this.wrapCondRe=/^(for|switch|catch|while|if|else\s+if)\s+(?!\()((\S|\s\S)*)\s*$/,this.callbackRe=/(function\s*\([^\)]*\)\s*)[^\{]/}var n=t("./slm"),s=i.prototype=new n;s.on_slm_control=function(t){var e,i=t[2],n=t[3];return(e=this.wrapCondRe.exec(i))&&(i=i.replace(e[2],"("+e[2]+")")),this.blockRe.test(i)||this.isEmptyExp(n)||(i+="{",n.push(["code","}"])),["slm","control",i,this.compile(n)]},s.on_slm_output=function(t){var e,i=t[3],n=t[4],s="}";if(!this.blockRe.test(i)&&!this.isEmptyExp(n)){if(e=this.callbackRe.exec(i)){var r=e.index+e[1].length;s+=i.slice(r),i=i.slice(0,r)}i+="{",n.push(["code",s])}return["slm","output",t[2],i,this.compile(n)]},e.exports=i},{"./slm":14}],8:[function(t,e){function i(){this.attr=null,this.mergeAttrs={"class":" "}}var n=t("./slm"),s=i.prototype=new n;s.on_html_attrs=function(t){for(var e=["multi"],i=2,n=t.length;n>i;i++)e.push(this.compile(t[i]));return e},s.on_html_attr=function(t){var e=t[2],i=t[3];if("slm"!==i[0]||"attrvalue"!==i[1]||this.mergeAttrs[e])return this.attr=e,n.prototype.on_html_attr.call(this,t);var s=i[2],r=i[3];switch(r){case"true":return["html","attr",e,["multi"]];case"false":case"null":case"undefined":return["multi"];default:var h=this.uniqueName();return["multi",["code","var "+h+"="+r],["switch",h,["true",["multi",["html","attr",e,["multi"]],["code","break"]]],["false",["multi"]],["undefined",["multi"]],["null",["code","break"]],["default",["html","attr",e,["escape",s,["dynamic",h]]]]]]}},s.on_slm_attrvalue=function(t){var e=t[2],i=t[3],n=this.mergeAttrs[this.attr];if(n){var s=this.uniqueName();return["multi",["code","var "+s+"="+i+";"],["if",s+" instanceof Array",["multi",["code",s+"=slm.rejectEmpty(slm.flatten("+s+"));"],["escape",e,["dynamic",s+'.join("'+n+'")']]],["escape",e,["dynamic",s]]]]}return["escape",e,["dynamic",i]]},e.exports=i},{"./slm":14}],9:[function(t,e){function i(){}var n=t("./slm"),s=i.prototype=new n;s.on_switch=function(t){for(var e=t[1],i=["multi",["code","switch("+e+"){"]],n=t.length,s=2;n>s;s++){var r=t[s];i.push(["code","default"===r[0]?"default:":"case "+r[0]+":"]),i.push(this.compile(r[1]))}return i.push(["code","}"]),i},s.on_if=function(t){for(var e=t[1],i=t[2],n=t[3],s=["multi",["code","if("+e+"){"],this.compile(i)];n&&"if"===n[0];)s.push(["code","}else if("+n[1]+"){"]),s.push(this.compile(n[2])),n=n[3];return n&&(s.push(["code","}else{"]),s.push(this.compile(n))),s.push(["code","}"]),s},s.on_block=function(t){var e=t[1],i=t[2];return["multi",["code",e],this.compile(i)]},e.exports=i},{"./slm":14}],10:[function(t,e){function i(){this.ifRe=/^(if)\b|{\s*$/}var n=t("./slm"),s=i.prototype=new n;s.on_slm_control=function(t){return["multi",["code",t[2]],this.compile(t[3])]},s.on_slm_output=function(t){var e=t[2],i=t[3],n=t[4];if(this.ifRe.test(i)){var s=this.uniqueName(),r=this.uniqueName();return n=this.compile(n),n.splice(n.length-2,0,["code","return slm.safe("+r+");"]),["multi",["block","var "+s+"="+i,["capture",r,"var "+r+"='';",n]],["escape","escape",["dynamic",s]]]}return["multi",["escape",e,["dynamic",i]],n]},s.on_slm_text=function(t){return this.compile(t[2])},e.exports=i},{"./slm":14}],11:[function(t,e){function i(){this.disableEscape=!1,this.escape=!1,this.escaper=s.escape}var n=t("../filter"),s=t("../runtime"),r=i.prototype=new n;r.escapeCode=function(t){return"slm.escape("+t+")"},r.on_escape=function(t){var e=this.escape;this.escape=t[1]&&!this.disableEscape;try{return this.compile(t[2])}finally{this.escape=e}},r.on_static=function(t){return["static",this.escape?this.escaper(t[1]):t[1]]},r.on_dynamic=function(t){return["dynamic",this.escape?this.escapeCode(t[1]):t[1]]},e.exports=i},{"../filter":4,"../runtime":21}],12:[function(t,e){function i(){this.escapedInterpolationRe=/^\\\$\{/,this.interpolationRe=/^\$\{/,this.staticTextRe=/^([\$\\]|[^\$\\]*)/}var n=t("./slm"),s=i.prototype=new n;s.on_slm_interpolate=function(t){var e,i,n=t[2],s=["multi"];do if(e=this.escapedInterpolationRe.exec(n))s.push(["static","${"]),n=n.slice(e[0].length);else if(e=this.interpolationRe.exec(n)){var r=this.parseExpression(n.slice(e[0].length));n=r[0],i=r[1];var h="="!==i[0];s.push(["slm","output",h,h?i:i.slice(1),["multi"]])}else(e=this.staticTextRe.exec(n))&&(s.push(["static",e[0]]),n=n.slice(e[0].length));while(n.length);return s},s.parseExpression=function(t){for(var e=1,i=0,n=t.length;n>i&&e;i++)"{"===t[i]?e++:"}"===t[i]&&e--;if(e)throw new Error("Text interpolation: Expected closing }");var s=t.substring(0,i-1);return[t.slice(i),s]},e.exports=i},{"./slm":14}],13:[function(t,e){function i(){}var n=t("../filter");i.prototype=new n,i.prototype.on_multi=function(t){var e=t.length;if(2===e)return this.compile(t[1]);for(var i=["multi"],n=1;e>n;n++){var s=t[n];if(s=this.compile(s),"multi"===s[0])for(var r=1,h=s.length;h>r;r++)i.push(s[r]);else i.push(s)}return i},e.exports=i},{"../filter":4}],14:[function(t,e){function i(){}var n=t("../html/html"),s=i.prototype=new n;s.on_slm_text=function(t){return t[2]=this.compile(t[2]),t},s.on_slm_embedded=function(t){return t[3]=this.compile(t[3]),t},s.on_slm_control=function(t){return t[3]=this.compile(t[3]),t},s.on_slm_output=function(t){return t[4]=this.compile(t[4]),t},e.exports=i},{"../html/html":19}],15:[function(t,e){function i(){}var n=t("../filter");i.prototype=new n,i.prototype.on_multi=function(t){for(var e,i=["multi"],n=1,s=t.length;s>n;n++){var r=t[n];"static"===r[0]?e?e[1]+=r[1]:(e=["static",r[1]],i.push(e)):(i.push(this.compile(r)),"newline"!==r[0]&&(e=null))}return 2==i.length?i[1]:i},e.exports=i},{"../filter":4}],16:[function(t,e){function i(){this.buffer="_b"}var n=t("./dispatcher"),s=i.prototype=new n;s.exec=function(t){return[this.preamble(),this.compile(t),this.postamble()].join("\n")},s.on=function(t){throw new Error("Generator supports only core expressions - found "+JSON.stringify(t))},s.on_multi=function(t){for(var e=[],i=1,n=t.length;n>i;i++)e[i]=this.compile(t[i]);return e.join("\n")},s.on_newline=function(){return"\n"},s.on_static=function(t){return this.concat(JSON.stringify(t[1]))},s.on_dynamic=function(t){return this.concat(t[1])},s.on_code=function(t){return t[1]},s.concat=function(t){return this.buffer+"+="+t+";"},e.exports=i},{"./dispatcher":1}],17:[function(t,e){function i(t,e,i){this.buffer=t||"_b",this.capture=e,this.initializer=i}var n=t("../generator"),s=i.prototype=new n;s.preamble=function(){return this.capture?this.initializer?this.initializer:"var "+this.buffer+'="";':"var "+this.buffer+"='';"},s.postamble=function(){return this.capture?"":"return "+this.buffer+";"},s.on_capture=function(t){var e=new i(t[1],!0,t[2]);return e.dispatcher=this.dispatcher,e.exec(t[3])},e.exports=i},{"../generator":16}],18:[function(t,e){function i(){switch(this.format="xhtml",this.attrQuote='"',this.autoclose="base basefont bgsound link meta area br embed img keygen wbr input menuitem param source track hr col frame".split(/\s/),this.jsWrapper="guess",this.HTML=["html","html4","html5"],"guess"===this.jsWrapper&&(this.jsWrapper="xhtml"===this.format?"cdata":"comment"),this.jsWrapper){case"comment":this.jsWrapper=["<!--\n","\n//-->"];break;case"cdata":this.jsWrapper=["\n//<![CDATA[\n","\n//]]>\n"];break;case"both":this.jsWrapper=["<!--\n//<![CDATA[\n","\n//]]>\n//-->"]}}var n=t("./html"),s=i.prototype=new n;s.on_html_doctype=function(t){var e=t[2],i={1.1:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">',5:"<!DOCTYPE html>",html:"<!DOCTYPE html>",strict:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">',frameset:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Frameset//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-frameset.dtd">',mobile:'<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.2//EN" "http://www.openmobilealliance.org/tech/DTD/xhtml-mobile12.dtd">',basic:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.1//EN" "http://www.w3.org/TR/xhtml-basic/xhtml-basic11.dtd">',transitional:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',svg:'<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'},n={5:"<!DOCTYPE html>",html:"<!DOCTYPE html>",strict:'<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">',frameset:'<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Frameset//EN" "http://www.w3.org/TR/html4/frameset.dtd">',transitional:'<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">'};e=e.toString().toLowerCase();var s,r;if(s=/^xml(\s+(.+))?$/.exec(e)){if("xhtml"!==this.format)throw new Error("Invalid xml directive in html mode");var h=this.attrQuote;r="<?xml version="+h+"1.0"+h+" encoding="+h+(s[2]||"utf-8")+h+" ?>"}else if("xhtml"!==this.format){if(r=n[e],!r)throw new Error("Invalid html doctype "+e)}else if(r=i[e],!r)throw new Error("Invalid xhtml doctype "+e);return["static",r]},s.on_html_comment=function(t){return["multi",["static","<!--"],this.compile(t[2]),["static","-->"]]},s.on_html_condcomment=function(t){return this.on_html_comment(["html","comment",["multi",["static","["+t[2]+"]>"],t[3],["static","<![endif]"]]])},s.on_html_tag=function(t){var e=t[2].toString(),i=t[3],n=t[4],s=!n||this.isEmptyExp(n)&&-1!==this.autoclose.indexOf(e),r=["multi",["static","<"+e],this.compile(i),["static",(s&&"xhtml"===this.format?" /":"")+">"]];return n&&r.push(this.compile(n)),s||r.push(["static","</"+e+">"]),r},s.on_html_attrs=function(t){for(var e=["multi"],i=2,n=t.length;n>i;i++)e.push(this.compile(t[i]));return e},s.on_html_attr=function(t){var e=t[2],i=t[3];return"xhtml"!==this.format&&this.isEmptyExp(i)?["static"," "+e]:["multi",["static"," "+e+"="+this.attrQuote],this.compile(i),["static",this.attrQuote]]},s.on_html_js=function(t){var e=t[2];return this.jsWrapper?["multi",["static",this.jsWrapper[0]],this.compile(e),["static",this.jsWrapper[1]]]:this.compile(e)},e.exports=i},{"./html":19}],19:[function(t,e){function i(){}var n=t("../filter"),s=i.prototype=new n;s.on_html_attrs=function(t){for(var e=t.length,i=2;e>i;i++)t[i]=this.compile(t[i]);return t},s.on_html_attr=function(t){return["html","attr",t[2],this.compile(t[3])]},s.on_html_comment=function(t){return["html","comment",this.compile(t[2])]},s.on_html_condcomment=function(t){return["html","condcomment",t[2],this.compile(t[3])]},s.on_html_js=function(t){return["html","js",this.compile(t[2])]},s.on_html_tag=function(t){var e=t[4],i=["html","tag",t[2],this.compile(t[3])];return e&&i.push(this.compile(e)),i},s.isContainNonEmptyStatic=function(t){switch(t[0]){case"multi":for(var e=1,i=t.length;i>e;e++)if(this.isContainNonEmptyStatic(t[e]))return!0;return!1;case"escape":return this.isContainNonEmptyStatic(t[t.length-1]);case"static":return t[1].length;default:return!1}},e.exports=i},{"../filter":4}],20:[function(t,e){function i(){this.file=null,this.lineno=0,this.lines=[],this.indents=[0],this.line=null,this.origLine=null,this.tagShortcut={".":"div","#":"div"},this.attrShortcut={"#":["id"],".":["class"]},this.attrDelims={"(":")","[":"]","{":"}"},this.tagRe=/^(?:#|\.|\*(?=[^\s]+)|(\w+(?:\w+|:|-)*\w|\w+))/,this.attrShortcutRe=/^([\.#]+)((?:\w+|-)*)/,this.attrName="^\\s*(\\w+(?:\\w+|:|-)*)",this.quotedAttrRe=new RegExp(this.attrName+"\\s*=(=?)\\s*(\"|')"),this.codeAttrRe=new RegExp(this.attrName+"\\s*=(=?)\\s*"),this.delimRe=/^[\(\)\[\]\{\}]/,this.attrDelimRe=/^\s*([\(\)\[\]\{\}])/,this.newLineRe=/\r?\n/,this.emptyLineRe=/^\s*$/,this.htmlCommentRe=/^\/!(\s?)/,this.htmlConditionalCommentRe=/^\/\[\s*(.*?)\s*\]\s*$/,this.blockExpressionRe=/^\s*:\s*/,this.doctypeRe=/^doctype\s+/i,this.textBlockRe=/^((\.)(\s|$))|((\|)(\s?))/,this.outputBlockRe=/^=(=?)([.<>]*)/,this.outputCodeRe=/^\s*=(=?)([.<>]*)/,this.embededRe=/^(\w+):\s*$/,this.closedTagRe=/^\s*\/\s*/,this.textContentRe=/^( ?)(.*)$/,this.indentRegex=/^[ \t]+/,this.indentationRe=/^\s+/,this.nextLineRe=/[,\\]$/,this.tabRe=/\t/g}var n=i.prototype;n.escapeRegExp=function(t){return t?t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"):""},n.reset=function(t,e){this.stacks=e||[],this.indents=[0],this.indents.last=this.stacks.last=function(){return this[this.length-1]},this.lineno=0,this.lines=t,this.line=this.origLine=null},n.pushOnTop=function(t){this.stacks.last().push(t)},n.nextLine=function(){return this.lines.length?(this.origLine=this.lines.shift(),this.lineno+=1,this.line=this.origLine):this.origLine=this.line=null},n.getIndent=function(t){var e=t.match(this.indentRegex);return e?e[0].replace(this.tabRe," ").length:0},n.exec=function(t,e){this.file=e&&e.file?e.file:null;var i=["multi"];for(this.reset(t.split(this.newLineRe),[i]);this.nextLine();)this.parseLine();return this.reset(),i},n.parseLine=function(){if(this.emptyLineRe.test(this.line))return void this.pushOnTop(["newline"]);var t=this.getIndent(this.line);this.line=this.line.replace(this.indentationRe,"");var e=this.stacks.length>this.indents.length;if(t>this.indents.last())e||this.syntaxError("Unexpected indentation"),this.indents.push(t);else{for(e&&this.stacks.pop();t<this.indents.last();)this.indents.pop(),this.stacks.pop();t!==this.indents.last()&&this.syntaxError("Malformed indentation")}this.parseLineIndicators()},n.parseLineIndicators=function(){do{var t;if(t=this.htmlCommentRe.exec(this.line)){this.pushOnTop(["html","comment",["slm","text",this.parseTextBlock(this.line.slice(t[0].length),this.indents.last()+t[1].length+2)]]);break}if(t=this.htmlConditionalCommentRe.exec(this.line)){var e=["multi"];this.pushOnTop(["html","condcomment",t[1],e]),this.stacks.push(e);break}var i=this.line[0];if("/"===i){this.parseCommentBlock();break}if(t=this.textBlockRe.exec(this.line)){var n,s;void 0===t[2]?(n=t[5],s=t[6]):(n=t[2],s=t[3]);var r="."===n;this.pushOnTop(["slm","text",this.parseTextBlock(this.line.slice(t[0].length),this.indents.last()+s.length+1)]),r&&this.pushOnTop(["static"," "]);break}if("<"===i){var e=["multi"];this.pushOnTop(["multi",["slm","interpolate",this.line],e]),this.stacks.push(e);break}if("-"===i){this.line=this.line.slice(1);var e=["multi"];this.pushOnTop(["slm","control",this.parseBrokenLine(),e]),this.stacks.push(e);break}if(t=this.outputBlockRe.exec(this.line)){this.line=this.line.slice(t[0].length);var r=-1!==t[2].indexOf(".")||-1!==t[2].indexOf(">"),e=["multi"];-1!==t[2].indexOf("<")&&this.pushOnTop(["static"," "]),this.pushOnTop(["slm","output",0===t[1].length,this.parseBrokenLine(),e]),r&&this.pushOnTop(["static"," "]),this.stacks.push(e);break}if(t=this.embededRe.exec(this.line)){this.pushOnTop(["slm","embedded",t[1],this.parseTextBlock()]);break}if(t=this.doctypeRe.exec(this.line)){var h=this.line.slice(t[0].length).trim();this.pushOnTop(["html","doctype",h]);break}if(t=this.tagRe.exec(this.line)){t[1]&&(this.line=this.line.slice(t[0].length)),this.parseTag(t[0]);break}this.syntaxError("Unknown line indicator")}while(!1);this.pushOnTop(["newline"])},n.parseTag=function(t){var e;this.tagShortcut[t]&&(this.attrShortcut[t]||(this.line=this.line.slice(0,t.length)),t=this.tagShortcut[t]);for(var i=["html","attrs"];e=this.attrShortcutRe.exec(this.line);){var n=this.attrShortcut[e[1]];n||this.syntaxError("Illegal shortcut");for(var s,r=0;s=n[r];r++)i.push(["html","attr",s,["static",e[2]]]);this.line=this.line.slice(e[0].length)}var h,o;(e=/^[<>.]+/.exec(this.line))&&(this.line=this.line.slice(e[0].length),h=e[0].indexOf(".")>=0||e[0].indexOf(">")>=0,o=e[0].indexOf("<")>=0),this.parseAttributes(i),t=["html","tag",t,i],o&&this.pushOnTop(["static"," "]),this.pushOnTop(t),h&&this.pushOnTop(["static"," "]);do{if(e=this.blockExpressionRe.exec(this.line)){this.line=this.line.slice(e[0].length),(e=this.tagRe.exec(this.line))||this.syntaxError("Expected tag"),e[1]&&(this.line=this.line.slice(e[0].length));var l=["multi"];t.push(l);var r=this.stacks.length;this.stacks.push(l),this.parseTag(e[0]),this.stacks.splice(r,1);break}if(e=this.outputCodeRe.exec(this.line)){this.line=this.line.slice(e[0].length);var a=e[2].indexOf(".")>=0||e[2].indexOf(">")>=0,c=e[2].indexOf("<")>=0,u=["multi"];if(!o&&c){var p=this.stacks.last();p.insert(p.length-2,0,["static"," "])}t.push(["slm","output","="!==e[1],this.parseBrokenLine(),u]),!h&&a&&this.pushOnTop(["static"," "]),this.stacks.push(u);break}if(e=this.closedTagRe.exec(this.line)){this.line=this.line.slice(e[0].length),this.line.length&&this.syntaxError("Unexpected text after closed tag");break}if(this.emptyLineRe.test(this.line)){var l=["multi"];t.push(l),this.stacks.push(l);break}if(e=this.textContentRe.exec(this.line)){t.push(["slm","text",this.parseTextBlock(e[2],this.origLine.length-this.line.length+e[1].length,!0)]);break}}while(!1)},n.parseAttributes=function(t){var e,i;(i=this.attrDelimRe.exec(this.line))&&(e=this.attrDelims[i[1]],this.line=this.line.slice(i[0].length));var n,s;for(e&&(n=new RegExp(this.attrName+"(?=(\\s|"+this.escapeRegExp(e)+"|$))"),s=new RegExp("^\\s*"+this.escapeRegExp(e)));;)if(i=this.quotedAttrRe.exec(this.line))this.line=this.line.slice(i[0].length),t.push(["html","attr",i[1],["escape",0===i[2].length,["slm","interpolate",this.parseQuotedAttribute(i[3])]]]);else if(i=this.codeAttrRe.exec(this.line)){this.line=this.line.slice(i[0].length);var r=i[1],h=0===i[2].length,o=this.parseJSCode(e);o.length||this.syntaxError("Invalid empty attribute"),t.push(["html","attr",r,["slm","attrvalue",h,o]])}else{if(!e)break;if(i=n.exec(this.line))this.line=this.line.slice(i[0].length),t.push(["html","attr",i[1],["multi"]]);else{if(i=s.exec(this.line)){this.line=this.line.slice(i[0].length);break}this.line=this.line.replace(this.indentationRe,""),this.line.length&&this.syntaxError("Expected attribute"),this.pushOnTop(["newline"]),this.lines.length||this.syntaxError("Expected closing delimiter "+e),this.nextLine()}}},n.parseTextBlock=function(t,e,i){var n=["multi"];t&&t.length?n.push(["slm","interpolate",t]):e=null;for(var s=0;this.lines.length;)if(this.emptyLineRe.test(this.lines[0]))this.nextLine(),n.push(["newline"]),e&&s++;else{var r=this.getIndent(this.lines[0]);if(r<=this.indents.last())break;s&&(n.push(["slm","interpolate",new Array(s+1).join("\n")]),s=0),this.nextLine(),this.line=this.line.replace(this.indentationRe,"");var h=e?r-e:0;0>h&&this.syntaxError("Text line not indented deep enough.\nThe first text line defines the necessary text indentation."+(i?"\nAre you trying to nest a child tag in a tag containing text? Use | for the text block!":"")),n.push(["newline"]),n.push(["slm","interpolate",(e?"\n":"")+new Array(h+1).join(" ")+this.line]),e=e||r}return n},n.parseCommentBlock=function(){for(;this.lines.length;){var t=this.emptyLineRe.test(this.lines[0])?0:this.getIndent(this.lines[0]);if(t<=this.indents.last())break;this.nextLine(),this.pushOnTop(["newline"])}},n.parseBrokenLine=function(){for(var t,e=this.line.trim();t=this.nextLineRe.exec(e);)this.expectNextLine(),"\\"===t[0]&&(e=e.slice(0,e.length-2)),e+="\n"+this.line;return e},n.parseJSCode=function(t){for(var e,i,n,s="",r=0,h=new RegExp("^[\\s"+this.escapeRegExp(t)+"]");this.line.length&&(r||!h.test(this.line));)this.nextLineRe.test(this.line)?(s+=this.line+"\n",this.expectNextLine()):(r>0?this.line[0]===e[0]?r++:this.line[0]===i[0]&&r--:(n=this.delimRe.exec(this.line))&&(r=1,e=n[0],i=this.attrDelims[n[0]]),s+=this.line[0],this.line=this.line.slice(1));return r&&this.syntaxError("Expected closing delimiter "+i),s},n.parseQuotedAttribute=function(t){for(var e="",i=0;this.line.length&&(i||this.line[0]!==t);)if(/^\\$/.test(this.line))e+=" ",this.expectNextLine();else{var n=this.line[0];i>0?"{"===n?i++:"}"===n&&i--:/^\$\{/.test(this.line)&&(e+=n,this.line=this.line.slice(1),i=1),e+=this.line[0],this.line=this.line.slice(1)}return i&&this.syntaxError("Expected closing brace }"),this.line[0]!==t&&this.syntaxError("Expected closing quote "+t),this.line=this.line.slice(1),e},n.syntaxError=function(t){var e=null!=this.origLine&&null!=this.line?this.origLine.length-this.line.length:0;e+=1;var i=[t,"  "+(this.file||"(__TEMPLATE__)")+", Line "+this.lineno+", Column "+e,"  "+this.origLine,"  "+new Array(e).join(" ")+"^",""].join("\n");throw new Error(i)},n.expectNextLine=function(){this.nextLine()||this.syntaxError("Unexpected end of file"),this.line=this.line.trim()},e.exports=i},{}],21:[function(t,e){function i(t){if(!t||t.htmlSafe)return t;var e=new String(t);return e.htmlSafe=!0,e}function n(t){if("string"!=typeof t){if(!t)return"";if(t.htmlSafe)return t.toString();t=t.toString()}return h.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(o,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(l,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(a,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(c,"&quot;"))),t}function s(t){for(var e=[],i=0,n=t.length;n>i;i++){var s=t[i];null!=s&&s.length&&e.push(s)}return e}function r(t){return t.reduce(function(t,e){return null==e?t:t.concat(e.constructor===Array?r(e):e.toString())},[])}var h=/[&<>"]/,o=/&/g,l=/</g,a=/>/g,c=/"/g;e.exports={safe:i,escape:n,rejectEmpty:s,flatten:r}},{}]},{},[3]);